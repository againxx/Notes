# Executable Stack
* GCC compiler implements an extension to C: nested functions, which requires executable stack to put the function's
instructions
* To implement it on GNU/Linux system, the compiler adds a new section `.note.GNU-stack`. It's empty and not allocated,
which means it takes up no space at runtime.
* If the code being compiled does not require an executable stack, the compiler does not set any flags for the section.
Otherwise, it sets the `SHF_EXECINSTR` flag.
* When linker links a program, it checks each input object for a `.note.GNU-stack` section. If there is no such section,
the linker assumes that the object must be old, and therefore require an executable stack. If there is such a section,
the linker checks the section flags to see whether the code requires an executable stack.
* The linker discards the `.note.GNU-stack` sections, and creates a `PT_GNU_STACK` segment in the output executable.
    - The segment is empty and is not part of any `PT_LOAD` segment.
    - The segment flags `PF_R` and `PF_W` are always set, if the linker has determined that the program requires an
    executable stack, it also sets the `PF_X` flag.
* When the Linux kernel starts a program, it looks for a `PT_GNU_STACK` segment. If it does not find one, it sets
the stack to be executable. If it does find a `PT_GNU_STACK` segment, it marks the stack as executable if the segment
flags call for it. Similarly for the dynamic loader.
* The `-z execstack` option tells the linker to mark the program as requiring an executable stack, regardless of the
input files. The `-z noexecstack` option marks it as not requiring an executable stack. The gold linker has a
`--warn-execstack` option which warn about any object which is missing a `.note.GNU-stack` or which has an
executable `.note.GNU-stack` option.
* The `execstack` program can be used to query whether a program requires an executable stack, and change its setting.

## Reference
[Airs – Ian Lance Taylor » Executable stack](https://www.airs.com/blog/archives/518)
